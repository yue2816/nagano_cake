<div class="container">
  <h1>注文情報確認</h1>
  <div class="row">
    <table class="table col-lg-8">
      <thead>
        <tr>
          <th>商品名</th>
          <th>単価(税込)</th>
          <th>数量</th>
          <th>小計</th>
          <th></th>
        </tr>
      </thead>
      <% @cart_items.each do |cart_item| %>
      <tbody>
        <tr>
          <td><%= cart_item.item.name %></td>
          <td><%= cart_item.item.with_tax_price %></td>
          <td><%= cart_item.amount %></td>
          <td><%= cart_item.subtotal %></td>
        </tr>
      </tbody>
      <% end %>
    </table>
    <div class="col-lg-1"></div>
    <table class="table col-lg-3">
      <tr>
        <th>送料</th>
        <% @order.shipping_fee = 800 %>
        <td><%= @order.shipping_fee %></td>
      </tr>
      <tr>
        <th>商品合計</th>
        <td><%= @total %></td>
      </tr>
      <tr>
        <th>請求金額</th>
        <% @order.amount_billed = @order.shipping_fee + @total %>
        <td><%= @order.amount_billed %></td>
      </tr>
    </table>
  </div>
</div>

<h3>支払方法</h3>
<p><%= @order.payment_i18n %></p>

<h3>お届け先</h3>
  <p>
    〒<%= @order.shipping_postal_code %><br>
    <%= @order.shipping_address %><br>
    <%= @order.shipping_name %>
  </p>

<%= form_with model: @order, url: orders_path, method: :post do |f| %>
  <%= f.hidden_field :customer_id %>
  <%= f.hidden_field :shipping_postal_code %>
  <%= f.hidden_field :shipping_address %>
  <%= f.hidden_field :shipping_name %>
  <%= f.hidden_field :payment %>
  <%= f.hidden_field :shipping_fee %>
  <%= f.hidden_field :amount_billed %>
  <%= f.submit "注文を確定する", class: "btn btn-success" %>
<% end %>